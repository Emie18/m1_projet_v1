<table>
    <thead>
        <tr>
            <th onclick="trier('apprenant')">Nom Prénom <span id="sapprenant" >▲</span></th>
            <th onclick="trier('date')">Date début-fin <span id ="sdate" >▲</span></th>
            <th onclick="trier('titre')">Titre stage <span id = "stitre">▲</span></th>
            <th onclick="trier('tuteur')" >Tuteur académique <span id="stuteur">▲</span></th>
            <th onclick="trier('soutenance')">Soutenance <span id="ssoutenance">▲</span></th>
            <th  onclick="trier('rapport')">Rapport <span id="srapport">▲</span></th>
            <th onclick="trier('eval')">Évaluation entreprise <span id="seval">▲</span></th>
        </tr>
    </thead>
    <tbody id="tableBody">
        {% for stage in stages %}
        <tr  onclick="afficherDetails({{ stage.id }});" class="lignetableau">
            <td>{{ stage.apprenant.nom }} {{ stage.apprenant.prenom }}</td>
            <td>{{ stage.dateDebut|date('d-m-Y') }} - {{ stage.dateFin|date('d-m-Y') }}</td>
            <td>{{ stage.titre }}</td>
            <td>{{ stage.tuteurIsen.nom }} {{ stage.tuteurIsen.prenom }}</td>
            <td id="soutenance{{ stage.id }}">{{ stage.soutenance }}</td>
            <td id="rapport{{ stage.id }}">{{ stage.rapport }}</td>
            <td id="eval{{ stage.id }}">{{ stage.evalEntreprise }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<div id="paginationButtons"></div>

<script>
function paginer(page) {
    var itemsPerPage = 5; // Nombre d'éléments par page
    var tableBody = document.getElementById("tableBody");
    var rows = tableBody.getElementsByTagName("tr");

    var startIndex = (page - 1) * itemsPerPage;
    var endIndex = startIndex + itemsPerPage;

    for (var i = 0; i < rows.length; i++) {
        if (i >= startIndex && i < endIndex) {
            rows[i].style.display = "";
        } else {
            rows[i].style.display = "none";
        }
    }

    // Mettre à jour les boutons de pagination
    var totalPages = Math.ceil(rows.length / itemsPerPage);
    var paginationButtons = document.getElementById("paginationButtons");

    // Effacer les boutons de pagination existants
    paginationButtons.innerHTML = '';

    // Bouton précédent
    if (page > 1) {
        paginationButtons.innerHTML += '<button onclick="paginer(' + (page - 1) + ')">Page précédente</button>';
    }

    // Liens vers chaque page
    var maxVisiblePages = 20; // Nombre maximal de boutons de page visibles
    var startPage = Math.max(1, page - Math.floor(maxVisiblePages / 2));
    var endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

    if (startPage > 1) {
        paginationButtons.innerHTML += '<button onclick="paginer(1)">1</button>';
        if (startPage > 2) {
            paginationButtons.innerHTML += '<span>...</span>';
        }
    }

    for (var i = startPage; i <= endPage; i++) {
        paginationButtons.innerHTML += '<button onclick="paginer(' + i + ')"' + (i === page ? ' class="active"' : '') + '>' + i + '</button>';
    }

    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            paginationButtons.innerHTML += '<span>...</span>';
        }
        paginationButtons.innerHTML += '<button onclick="paginer(' + totalPages + ')">' + totalPages + '</button>';
    }

    // Bouton suivant
    if (page < totalPages) {
        paginationButtons.innerHTML += '<button onclick="paginer(' + (page + 1) + ')">Page suivante</button>';
    }
}


// Appeler la fonction paginer pour afficher la première page lors du chargement de la page
document.addEventListener("DOMContentLoaded", function() {
    paginer(1);
});

function trier(colonne) {
    // Récupérer la valeur de l'élément nomInput
    var nomInput = document.getElementById('nameId');
    var nom = nomInput ? nomInput.value : '';
    var professeur = document.getElementById('profId').value;
    var groupe = document.getElementById('groupeId').value;
    // Récupérer le tableau
    var tableau = document.getElementById("tableBody");
    var annee = document.getElementById('anneeInput').value;
    // Récupérer les lignes du tableau
    var lignes = tableau.getElementsByTagName("tr");
    var ordreAlphabetique = 1;

   var span =document.getElementById("s"+colonne);
    if (span.innerHTML === "▲"){
        span.innerText = "▼";
        ordreAlphabetique = 1;
    } else {
        span.innerText = "▲";
        ordreAlphabetique = 2;
    }
    // Envoyer une requête AJAX
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "/trier/" + colonne + "?desc=" + ordreAlphabetique + "&apprenant=" + nom+"&tuteur="+professeur+"&annee="+annee+ '&groupe=' + groupe, true);
    console.log("/trier/" + colonne + "?desc=" + ordreAlphabetique + "&apprenant=" + nom+"&tuteur="+professeur);
    xhr.onreadystatechange = function() {
        if (xhr.readyState == XMLHttpRequest.DONE) {
            if (xhr.status == 200) {
                tableau.innerHTML = xhr.responseText;
                paginer(1, true); // Utilisez le tableau principal pour la pagination
            } else {
                console.error("Une erreur est survenue : " + xhr.status);
            }
        }
    };
    xhr.send();
}


</script>
